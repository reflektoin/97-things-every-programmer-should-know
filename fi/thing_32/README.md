# Kapseloi Toiminnot, ‰l‰ Pelkk‰‰ Tilaa

Systeemiteoriassa erist‰minen on yksi hyˆdyllisimmist‰ rakenteista laajojen ja monimutkaisten j‰rjestelmien k‰sittelyyn. Ohjelmistoteollisuudessa erist‰misen tai kapseloinnin hyˆdyt ymm‰rret‰‰n hyvin. Erist‰mist‰ tukee ohjelmointikielien rakenteet kuten alirutiinit ja funktiot, modulit ja paketit, luokat ja niin edelleen.

Modulit ja paketit ratkaisevat(address) isomman mittakaavan kapseloinnin tarpeet, kun taas luokat, alirutiinit ja funktiot ratkaisevat hienorakenteisemmat asiat(fine-grained aspects). Vuosien saatossa olen havainnut, ett‰ kehitt‰jille yksi hankalimmista kapselointirakenteista saada oikein ovat luokat. On yleist‰ lˆyt‰‰ luokka, jolla on 3000-rivinen main-metodi tai luokka, jolla on vain *set*- ja *get*-metodit sen alkeistietotyypeille(primitive attributes). N‰m‰ esimerkit osoittavat, etteiv‰t kehitt‰j‰t ole t‰ysin ymm‰rt‰neen olio-pohjaista ajattelua, he eiv‰t ole osanneet hyˆdynt‰‰ olioiden voimaa mallintamisen rakenteina(modeling constructs). POJO(Plain Old Java Object ja POCO(Plain Old C# Object or Plain Old CLR Object) termit tuntevat kehitt‰j‰t, t‰m‰ oli olio-ohjelmoinnin perusteisiin palaamisen aikomus - oliot ovat yksinkertaisia, mutta eiv‰t tyhmi‰.

Olio kapseloi sek‰ tilan ett‰ toiminnot, miss‰ toiminnot m‰‰r‰ytyv‰t tilan mukaan. Ajattele ovi-oliota. Sill‰ on nelj‰ tilaa: suljettu, avoinna, sulkeutumassa, avautumassa. Se tarjoaa kaksi operaatiota: avaa ja sulje. Riippuen sen tilasta, avaa- ja sulje-operaatiot k‰ytt‰ytyv‰t eri tavoin. T‰m‰ olion luontainen ominaisuus tekee suunnitteluprosessista konseptuaalisesti yksinkertaista. Se kiteytyy kahteen yksinkertaiseen teht‰v‰‰n: vastuun jakaminen ja delegointi eri objekteille, mukaan lukien olioiden v‰liset vuorovaikutusprotokollat.

T‰m‰ toteuttaminen k‰yt‰nnˆss‰ selvi‰‰ parhaiten esimerkill‰. Meill‰ on kolme luokkaa: Asiakas, Tilaus ja Nimike(Item). Asiakas-olio on luonnollinen paikanpit‰j‰ luottorajalle ja luoton vahvistuss‰‰nnˆille. Tilaus-olio tiet‰‰ siihen liittyv‰n Asiakkaan ja sen addItem-operaatio delegoi luottotarkastuksen kutsumalla `asiakas.vahvistaLuotto(nimike.hinta())`. Jos metodin j‰lkiehto ep‰onnistuu, annetaan poikkeus(throw exception) ja osto keskeytet‰‰n.

Kokemattomammat olio-ohjelmoinnin kehitt‰j‰t saattavat p‰‰tt‰‰ k‰‰ri‰ kaikki liiketoiminnan s‰‰nnˆt olioon, jota kutsutaan nimill‰ `TilausManageri` tai `TilausPalvelu`. N‰iss‰ suunnitteluissa, `Tilaus`, `Asiakas` ja `Nimike` ovat aika pitk‰lti vain tietueita(record type). Kaikki logiikka on poistettu(factored out) luokista ja sidottu yhteen isoon, proseduraaliseen, paljon *if-then-else* rakenteita sis‰lt‰v‰‰n metodiin. N‰m‰ metodit rikkoutuvat helposti ja on l‰hes mahdottomia yll‰pit‰‰. Syy? Kapselointi on hajalla.

Lopuksi, ‰l‰ riko kapselointia ja k‰yt‰ ohjelmointikielesi kykyj‰ yll‰pit‰‰ksesi sit‰.

Alkuper‰inen kirjoittaja [Einar Landre](http://programmer.97things.oreilly.com/wiki/index.php/Einar_Landre)