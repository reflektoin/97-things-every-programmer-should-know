# APIn suunnittelun kultainen sääntö

(API=Application Programmin Interface, suom. ohjelmointirajapinta)
APIn suunnitteleminen on vaikeaa, erityisesti isossa mittakaavassa(in the large). Jos suunnittelet satojen tai tuhansien käyttämää APIa, sinun tulee miettiä kuinka tulet muuttamaan sitä tulevaisuudessa tai rikkooko muutoksesi käyttäjän koodia. Sen lisäksi sinun tulee miettiä, miten APIsi käyttäjät tulevat vaikuttamaan sinuun. Jos yksi APIsi luokista käyttää yhtä sen omista metodeista sisäisesti, sinun tulee muistaa että käyttäjä voi tehdä alikuodan siitä ja ylikirjoittaa sen, sillä voi olla tuhoisat vaikutukset. Et voisi muuttaa metodiasi, koska jotkut käyttäjät ovat antaneet sille eri merkityksen. Sinun tulevaisuudessa tekemät sisäiset toteutuksen valinnat ovat käyttäjiesi armoilla.

APIen kehittäjät ratkaisevat tämän ongelman lukuisilla tavoilla, mutta helpointa on lukita(lock down) API. Jos työskentet Javalla, voi olla kiusaus tehdä suurin osa luokistasi ja metodeistasi final-määreellä. C#:ssa saattaisi sinetöidä luokkasi ja metodisi. Käyttämästäsi kielestä riippumatta, sinulla voi tulla kiusaus esittää APIsi singletonina tai käyttää staattisia tehdas-metodeja, jotta voit suojata sitä henkilöiltä, jotka saattaisivat korvata käyttäytymisen ja käyttää koodiasi tavoin, joka rajoittaisi mahdollisia valintojasi myöhemmin. Kaikki tämä vaikuttaa kohtuulliselta, mutta onko se sitä?

Viime vuosikymmenen aikana, olemme asteittain ymmärtäneet yksikkotestauksen tärkeän roolin, mutta se oppi ei ole täysin levinnyt alalla. Todisteita on kaikkialla ympärillämme. Valitse mielivaltainen luokka, joka käyttää kolmannen osapuolen APIa ja yritä kirjoittaa yksikkötestejä sille. Useimmiten ajaudut ongelmiin. Huomaat, että APIa käyttävä koodi on kuin liimattu siihen. Ei ole mitää tapaa imitoida API-luokkia, jotta voisit ymmärtää koodisi vuorovaikutuksen niiden kanssa, tai syöttää palautusarvoja testitarkoituksessa.

Ajan kuluessa tilanne parantuu, mutta vain jos ryhdymme näkemään testaamisen todellisena käyttötapauksena suunnitellessamme ohjelmointirajapintoja. Valitettavasti se on hieman työläämpää kuin vain koodimme testaamista. Siihen kohtaan **APIn suunnittelun kultainen sääntö** sopii: *Ei riitä, että kirjoitat testejä kehittämällesi APIlle; sinun täytyy kirjoittaa yksikkötestejä koodille, joka käyttää APIasi. Kun kirjoitat niitä, opit kokemuksen kautta esteet, joita käyttäjäsi joutuvat ylittämään kun he yrittävät testata koodiaan itsenäisesti.*

Ei ole yhtä ainutta tapaa helpottaa APIasi käyttävän koodin testaamista. `staatic`, `final` ja `sealed` eivät ole pohjimmiltaan huonoja rakenteita(construct). Ajoittain ne voivat olla hyödyllisiä. Mutta on tärkeä olla tietoinen testaamisen ongelmasta, ja sitä varten sinun täytyy kokea se itse. Koettuasi sen, voit lähestyä sitä kuten mitä tahansa muuta suunnitteluhaastetta.

Alkuperäinen kirjoittaja [Michael Feathers](http://programmer.97things.oreilly.com/wiki/index.php/Michael_Feathers)